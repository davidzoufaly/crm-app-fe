{"ast":null,"code":"import _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { useState, useReducer, useContext } from \"react\";\nimport axios from \"axios\";\nimport uniqid from \"uniqid\";\nimport generateUniqueId from \"generate-unique-id\";\nimport AddOrEditField from \"./AddOrEditField\";\nimport UserContext from \"../../UserContext\";\nimport CustomFieldsList from \"./CustomFieldsList\";\nimport SelectFieldOptions from \"./SelectFieldOptions\";\nimport globalVars from \"../../../library/globalVariables\";\nimport { Box } from \"@material-ui/core\";\n\nconst CustomClientFields = ({\n  fields,\n  addField,\n  removeField\n}) => {\n  const blankFieldObject = {\n    fieldName: \"\",\n    fieldType: \"text\",\n    fieldOptions: [],\n    fieldFormVisible: null,\n    _id: generateUniqueId({\n      length: 24,\n      useNumbers: true,\n      useLetters: false,\n      includeSymbols: [\"a\", \"b\", \"c\", \"d\", \"e\", \"f\"]\n    })\n  };\n  const user = useContext(UserContext);\n  const {\n    0: displayComponent,\n    1: setDisplayComponent\n  } = useState(false);\n  const {\n    0: editedField,\n    1: setEditedField\n  } = useReducer((state, action) => {\n    switch (action.type) {\n      case \"fieldNameChange\":\n        return _objectSpread({}, state, {\n          fieldName: action.payload.value\n        });\n\n      case \"selectValueChange\":\n        return _objectSpread({}, state, {\n          fieldType: action.payload.value\n        });\n\n      case \"newOptionSpawn\":\n        return _objectSpread({}, state, {\n          fieldOptions: [...state.fieldOptions, {\n            id: uniqid(),\n            value: \"\"\n          }]\n        });\n\n      case \"clear\":\n        return blankFieldObject;\n\n      case \"optionValueChange\":\n        return _objectSpread({}, state, {\n          fieldOptions: state.fieldOptions.map(el => el.id === action.payload.id ? _objectSpread({}, el, {\n            value: action.payload.value\n          }) : el)\n        });\n\n      case \"optionDelete\":\n        return _objectSpread({}, state, {\n          fieldOptions: state.fieldOptions.filter(e => action.payload.id !== e.id)\n        });\n\n      case \"setWithPaylod\":\n        return action.payload.obj;\n\n      default:\n        return state;\n    }\n  }, blankFieldObject);\n  const fieldMethods = {\n    onNameChange(event) {\n      setEditedField({\n        type: \"fieldNameChange\",\n        payload: {\n          value: event.target.value\n        }\n      });\n    },\n\n    onSelectChange(event) {\n      setEditedField({\n        type: \"selectValueChange\",\n        payload: {\n          value: event.target.value\n        }\n      });\n    },\n\n    handleOptionSpawn(e) {\n      e.preventDefault();\n      setEditedField({\n        type: \"newOptionSpawn\"\n      });\n    },\n\n    toggleDisplayComponent() {\n      displayComponent ? setDisplayComponent(false) : setDisplayComponent(true);\n      setEditedField({\n        type: \"clear\"\n      });\n    },\n\n    onOptionDelete(event) {\n      setEditedField({\n        type: \"optionDelete\",\n        payload: {\n          id: event.currentTarget.id\n        }\n      });\n    },\n\n    onOptionChange(id, event) {\n      setEditedField({\n        type: \"optionValueChange\",\n        payload: {\n          value: event.target.value,\n          id\n        }\n      });\n    },\n\n    setupEditedField(obj) {\n      setEditedField({\n        type: \"setWithPaylod\",\n        payload: {\n          obj\n        }\n      });\n      !displayComponent ? setDisplayComponent(true) : null;\n    },\n\n    saveEditedField(e) {\n      e.preventDefault();\n\n      const fieldIsUpdated = async () => {\n        const {\n          fieldName,\n          fieldType,\n          fieldOptions,\n          _id\n        } = editedField;\n        const res = await axios({\n          method: \"PUT\",\n          url: `${globalVars.serverURL}/fields/${_id}`,\n          params: {\n            key: user.user.userkey\n          },\n          data: {\n            fieldName,\n            fieldType,\n            fieldOptions\n          },\n          responseType: \"json\"\n        });\n        const data = await res.data;\n\n        if (data.msg === globalVars.msgSuccess) {\n          reset();\n        }\n      };\n\n      const fieldIsCreated = async () => {\n        const res = await axios({\n          method: \"POST\",\n          params: {\n            key: user.user.userkey\n          },\n          url: `${globalVars.serverURL}/fields/`,\n          data: editedField,\n          responseType: \"json\"\n        });\n        const data = await res.data;\n\n        if (data.msg === globalVars.msgSuccess) {\n          reset();\n        }\n      };\n\n      fields.some(field => field._id === editedField._id) ? fieldIsUpdated() : fieldIsCreated();\n    }\n\n  };\n\n  const reset = () => {\n    setDisplayComponent(false);\n    addField(editedField);\n    setEditedField({\n      type: \"clear\"\n    });\n  };\n\n  const deleteField = async id => {\n    const res = await axios({\n      method: \"DELETE\",\n      params: {\n        key: user.user.userkey\n      },\n      url: `${globalVars.serverURL}/fields/${id}`,\n      responseType: \"json\"\n    });\n    const resData = await res.data;\n    resData.msg === globalVars.msgSuccess ? removeField(id) : null;\n  };\n\n  return __jsx(Box, {\n    mt: \"1rem\",\n    mb: \"5rem\"\n  }, __jsx(CustomFieldsList, {\n    deleteField: deleteField,\n    fields: fields,\n    setupEditedField: fieldMethods.setupEditedField\n  }), __jsx(AddOrEditField, {\n    editedField: editedField,\n    displayComponent: displayComponent,\n    fieldMethods: fieldMethods,\n    handleOption: __jsx(SelectFieldOptions, {\n      options: editedField.fieldOptions,\n      fieldMethods: fieldMethods\n    })\n  }));\n};\n\nexport default CustomClientFields;","map":null,"metadata":{},"sourceType":"module"}