{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport Header from \"../../components/Header\";\nimport { useRouter } from \"next/router\";\nimport { useState, useEffect, useContext } from \"react\";\nimport axios from \"axios\";\nimport UserContext from \"../../components/UserContext\";\nimport DefaultFieldsSection from \"../../components/settings/DefaultFieldsSection\";\nimport CustomFieldsSection from \"../../components/settings/customFields/CustomFieldsSection\";\nimport LoadingSpinner from \"../../components/LoadingSpinner\";\nimport EmailSettingsSection from \"../../components/settings/emailSettings/EmailSettingsSection\";\nimport WebFormSection from \"../../components/settings/webform/WebFormSection\";\nimport globalVars from \"../../library/globalVariables\";\nimport stringMethods from \"../../library/stringMethods\";\nimport Typography from \"@material-ui/core/Typography\";\n\nvar Settings = function Settings(_ref) {\n  var dataFields = _ref.dataFields,\n      username = _ref.username,\n      pass = _ref.pass;\n  var router = useRouter();\n\n  var _useState = useState(dataFields),\n      fields = _useState[0],\n      setField = _useState[1];\n\n  var _useState2 = useState(false),\n      initialized = _useState2[0],\n      setInitialized = _useState2[1];\n\n  var _useState3 = useState({}),\n      sections = _useState3[0],\n      setSection = _useState3[1];\n\n  var user = useContext(UserContext);\n\n  var toggleSection = function toggleSection(e) {\n    setSection(_objectSpread({}, sections, _defineProperty({}, e.target.name, e.target.checked)));\n  };\n\n  var addField = function addField(obj) {\n    setField(fields.some(function (field) {\n      return field._id === obj._id;\n    }) ? fields.map(function (field) {\n      return field._id === obj._id ? obj : field;\n    }) : [].concat(_toConsumableArray(fields), [obj]));\n  };\n\n  var removeField = function removeField(id) {\n    setField(fields.filter(function (field) {\n      return field._id !== id;\n    }));\n  };\n\n  useEffect(function () {\n    //title from url\n    var title = new stringMethods(router.pathname).removeSlash().removeSlashAndTextAfter().firstCharUpperCase().addStringToEnd(globalVars.titleSubText).getString();\n    document.title = title; //componendDidMount effect\n\n    setInitialized(true);\n    user.checkUser();\n  }, [router]);\n  var h1 = new stringMethods(router.pathname).removeSlash().removeSlashAndTextAfter().firstCharUpperCase().getString();\n  return !user.user.signedIn && !initialized ? __jsx(LoadingSpinner, null) : __jsx(\"div\", null, __jsx(Header, null), __jsx(Typography, {\n    variant: \"h3\",\n    component: \"h1\",\n    gutterBottom: true\n  }, h1), __jsx(DefaultFieldsSection, {\n    fields: fields,\n    toggleSection: toggleSection,\n    sections: sections\n  }), __jsx(CustomFieldsSection, {\n    fields: fields,\n    removeField: removeField,\n    addField: addField,\n    sections: sections,\n    toggleSection: toggleSection\n  }), __jsx(EmailSettingsSection, {\n    username: username,\n    pass: pass,\n    toggleSection: toggleSection,\n    sections: sections\n  }), __jsx(WebFormSection, {\n    fields: fields,\n    toggleSection: toggleSection,\n    sections: sections\n  }));\n};\n\nSettings.getInitialProps =\n/*#__PURE__*/\nfunction () {\n  var _ref2 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee(context) {\n    var resFields, dataFields, resEmailSettings, dataEmailSettings, _ref3, username, pass;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return axios({\n              method: \"GET\",\n              params: {\n                key: context.query.key\n              },\n              url: \"\".concat(globalVars.serverURL, \"/fields\"),\n              responseType: \"json\"\n            });\n\n          case 2:\n            resFields = _context.sent;\n            _context.next = 5;\n            return resFields.data;\n\n          case 5:\n            dataFields = _context.sent;\n            _context.next = 8;\n            return axios({\n              method: \"GET\",\n              params: {\n                key: context.query.key\n              },\n              url: \"\".concat(globalVars.serverURL, \"/emails/email-settings\"),\n              responseType: \"json\"\n            });\n\n          case 8:\n            resEmailSettings = _context.sent;\n            _context.next = 11;\n            return resEmailSettings.data;\n\n          case 11:\n            dataEmailSettings = _context.sent;\n            _context.next = 14;\n            return dataEmailSettings;\n\n          case 14:\n            _ref3 = _context.sent;\n            username = _ref3.username;\n            pass = _ref3.pass;\n            return _context.abrupt(\"return\", {\n              dataFields: dataFields,\n              username: username,\n              pass: pass\n            });\n\n          case 18:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function (_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nexport default Settings;","map":null,"metadata":{},"sourceType":"module"}