{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nvar _jsxFileName = \"/Users/davidzoufaly/code/dp/crm-app-fe/components/settings/customFields/CustomFields.tsx\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { useState, useReducer, useContext } from \"react\";\nimport axios from \"axios\";\nimport uniqid from \"uniqid\";\nimport generateUniqueId from \"generate-unique-id\";\nimport AddOrEditField from \"./AddOrEditField\";\nimport UserContext from \"../../UserContext\";\nimport CustomFieldsList from \"./CustomFieldsList\";\nimport SelectFieldOptions from \"./SelectFieldOptions\";\nimport globalVars from \"../../../library/globalVariables\";\nimport { Box } from \"@material-ui/core\";\nimport { addField, deleteField } from \"../../../actions/fieldsAction\";\n\nvar CustomFields = function CustomFields(_ref) {\n  var state = _ref.state,\n      dispatch = _ref.dispatch;\n  var blankFieldObject = {\n    fieldName: \"\",\n    fieldType: \"text\",\n    fieldOptions: [],\n    fieldFormVisible: null,\n    _id: generateUniqueId({\n      length: 24,\n      useNumbers: true,\n      useLetters: false,\n      includeSymbols: [\"a\", \"b\", \"c\", \"d\", \"e\", \"f\"]\n    })\n  };\n  var user = useContext(UserContext);\n\n  var _useState = useState(false),\n      displayComponent = _useState[0],\n      setDisplayComponent = _useState[1];\n\n  var _useReducer = useReducer(function (state, action) {\n    switch (action.type) {\n      case \"fieldNameChange\":\n        return _objectSpread({}, state, {\n          fieldName: action.payload.value\n        });\n\n      case \"selectValueChange\":\n        return _objectSpread({}, state, {\n          fieldType: action.payload.value\n        });\n\n      case \"newOptionSpawn\":\n        return _objectSpread({}, state, {\n          fieldOptions: [].concat(_toConsumableArray(state.fieldOptions), [{\n            id: uniqid(),\n            value: \"\"\n          }])\n        });\n\n      case \"clear\":\n        return blankFieldObject;\n\n      case \"optionValueChange\":\n        return _objectSpread({}, state, {\n          fieldOptions: state.fieldOptions.map(function (el) {\n            return el.id === action.payload.id ? _objectSpread({}, el, {\n              value: action.payload.value\n            }) : el;\n          })\n        });\n\n      case \"optionDelete\":\n        return state.fieldInForm && state.fieldOptions.some(function (el) {\n          return el.id === action.payload.id && el.preselected;\n        }) ? _objectSpread({}, state, {\n          fieldInForm: false,\n          fieldOptions: state.fieldOptions.filter(function (e) {\n            return e.id !== action.payload.id;\n          })\n        }) : _objectSpread({}, state, {\n          fieldOptions: state.fieldOptions.filter(function (e) {\n            return e.id !== action.payload.id;\n          })\n        });\n\n      case \"setWithPaylod\":\n        return action.payload.obj;\n\n      default:\n        return state;\n    }\n  }, blankFieldObject),\n      editedField = _useReducer[0],\n      setEditedField = _useReducer[1];\n\n  var fieldMethods = {\n    onNameChange: function onNameChange(event) {\n      setEditedField({\n        type: \"fieldNameChange\",\n        payload: {\n          value: event.target.value\n        }\n      });\n    },\n    onSelectChange: function onSelectChange(event) {\n      setEditedField({\n        type: \"selectValueChange\",\n        payload: {\n          value: event.target.value\n        }\n      });\n    },\n    handleOptionSpawn: function handleOptionSpawn(e) {\n      e.preventDefault();\n      setEditedField({\n        type: \"newOptionSpawn\"\n      });\n    },\n    toggleDisplayComponent: function toggleDisplayComponent() {\n      displayComponent ? setDisplayComponent(false) : setDisplayComponent(true);\n      setEditedField({\n        type: \"clear\"\n      });\n    },\n    onOptionDelete: function onOptionDelete(event) {\n      setEditedField({\n        type: \"optionDelete\",\n        payload: {\n          id: event.currentTarget.id\n        }\n      });\n    },\n    onOptionChange: function onOptionChange(id, event) {\n      setEditedField({\n        type: \"optionValueChange\",\n        payload: {\n          value: event.target.value,\n          id: id\n        }\n      });\n    },\n    setupEditedField: function setupEditedField(obj) {\n      setEditedField({\n        type: \"setWithPaylod\",\n        payload: {\n          obj: obj\n        }\n      });\n      !displayComponent ? setDisplayComponent(true) : null;\n    },\n    saveEditedField: function saveEditedField(e) {\n      e.preventDefault();\n\n      var fieldIsUpdated =\n      /*#__PURE__*/\n      function () {\n        var _ref2 = _asyncToGenerator(\n        /*#__PURE__*/\n        _regeneratorRuntime.mark(function _callee() {\n          var fieldName, fieldType, fieldOptions, _id, res, data;\n\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  fieldName = editedField.fieldName, fieldType = editedField.fieldType, fieldOptions = editedField.fieldOptions, _id = editedField._id;\n                  _context.next = 3;\n                  return axios({\n                    method: \"PUT\",\n                    url: \"\".concat(globalVars.serverURL, \"/fields/\").concat(_id),\n                    params: {\n                      key: user.user.userkey\n                    },\n                    data: {\n                      fieldName: fieldName,\n                      fieldType: fieldType,\n                      fieldOptions: fieldOptions\n                    },\n                    responseType: \"json\"\n                  });\n\n                case 3:\n                  res = _context.sent;\n                  _context.next = 6;\n                  return res.data;\n\n                case 6:\n                  data = _context.sent;\n\n                  if (data.msg === globalVars.msgSuccess) {\n                    reset();\n                  }\n\n                case 8:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        return function fieldIsUpdated() {\n          return _ref2.apply(this, arguments);\n        };\n      }();\n\n      var fieldIsCreated =\n      /*#__PURE__*/\n      function () {\n        var _ref3 = _asyncToGenerator(\n        /*#__PURE__*/\n        _regeneratorRuntime.mark(function _callee2() {\n          var res, data;\n          return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n            while (1) {\n              switch (_context2.prev = _context2.next) {\n                case 0:\n                  _context2.next = 2;\n                  return axios({\n                    method: \"POST\",\n                    params: {\n                      key: user.user.userkey\n                    },\n                    url: \"\".concat(globalVars.serverURL, \"/fields/\"),\n                    data: editedField,\n                    responseType: \"json\"\n                  });\n\n                case 2:\n                  res = _context2.sent;\n                  _context2.next = 5;\n                  return res.data;\n\n                case 5:\n                  data = _context2.sent;\n\n                  if (data.msg === globalVars.msgSuccess) {\n                    reset();\n                  }\n\n                case 7:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n          }, _callee2);\n        }));\n\n        return function fieldIsCreated() {\n          return _ref3.apply(this, arguments);\n        };\n      }();\n\n      state.some(function (field) {\n        return field._id === editedField._id;\n      }) ? fieldIsUpdated() : fieldIsCreated();\n    }\n  };\n\n  var reset = function reset() {\n    setDisplayComponent(false);\n    addField(dispatch, editedField);\n    setEditedField({\n      type: \"clear\"\n    });\n  };\n\n  var deleteFieldRes =\n  /*#__PURE__*/\n  function () {\n    var _ref4 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee3(id) {\n      var res, resData;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return axios({\n                method: \"DELETE\",\n                params: {\n                  key: user.user.userkey\n                },\n                url: \"\".concat(globalVars.serverURL, \"/fields/\").concat(id),\n                responseType: \"json\"\n              });\n\n            case 2:\n              res = _context3.sent;\n              _context3.next = 5;\n              return res.data;\n\n            case 5:\n              resData = _context3.sent;\n              resData.msg === globalVars.msgSuccess ? deleteField(dispatch, id) : null;\n\n            case 7:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function deleteFieldRes(_x) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(Box, {\n    mt: \"1rem\",\n    mb: \"5rem\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178\n    },\n    __self: this\n  }, __jsx(CustomFieldsList, {\n    deleteFieldRes: deleteFieldRes,\n    state: state,\n    setupEditedField: fieldMethods.setupEditedField,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179\n    },\n    __self: this\n  }), __jsx(AddOrEditField, {\n    editedField: editedField,\n    displayComponent: displayComponent,\n    fieldMethods: fieldMethods,\n    handleOption: __jsx(SelectFieldOptions, {\n      options: editedField.fieldOptions,\n      fieldMethods: fieldMethods,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 189\n      },\n      __self: this\n    }),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184\n    },\n    __self: this\n  }));\n};\n\nexport default CustomFields;","map":{"version":3,"sources":["/Users/davidzoufaly/code/dp/crm-app-fe/components/settings/customFields/CustomFields.tsx"],"names":["useState","useReducer","useContext","axios","uniqid","generateUniqueId","AddOrEditField","UserContext","CustomFieldsList","SelectFieldOptions","globalVars","Box","addField","deleteField","CustomFields","state","dispatch","blankFieldObject","fieldName","fieldType","fieldOptions","fieldFormVisible","_id","length","useNumbers","useLetters","includeSymbols","user","displayComponent","setDisplayComponent","action","type","payload","value","id","map","el","fieldInForm","some","preselected","filter","e","obj","editedField","setEditedField","fieldMethods","onNameChange","event","target","onSelectChange","handleOptionSpawn","preventDefault","toggleDisplayComponent","onOptionDelete","currentTarget","onOptionChange","setupEditedField","saveEditedField","fieldIsUpdated","method","url","serverURL","params","key","userkey","data","responseType","res","msg","msgSuccess","reset","fieldIsCreated","field","deleteFieldRes","resData"],"mappings":"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","sourcesContent":["import { useState, useReducer, useContext } from \"react\";\nimport axios from \"axios\";\nimport uniqid from \"uniqid\";\nimport generateUniqueId from \"generate-unique-id\";\nimport AddOrEditField from \"./AddOrEditField\";\nimport UserContext from \"../../UserContext\";\nimport CustomFieldsList from \"./CustomFieldsList\";\nimport SelectFieldOptions from \"./SelectFieldOptions\";\nimport globalVars from \"../../../library/globalVariables\";\nimport { Box } from \"@material-ui/core\";\nimport { addField, deleteField } from \"../../../actions/fieldsAction\";\n\nconst CustomFields = ({ state, dispatch }: any) => {\n  const blankFieldObject = {\n    fieldName: \"\",\n    fieldType: \"text\",\n    fieldOptions: [],\n    fieldFormVisible: null,\n    _id: generateUniqueId({\n      length: 24,\n      useNumbers: true,\n      useLetters: false,\n      includeSymbols: [\"a\", \"b\", \"c\", \"d\", \"e\", \"f\"]\n    })\n  };\n\n  const user = useContext(UserContext);\n  const [displayComponent, setDisplayComponent] = useState(false);\n\n  const [editedField, setEditedField] = useReducer((state, action) => {\n    switch (action.type) {\n      case \"fieldNameChange\":\n        return {\n          ...state,\n          fieldName: action.payload.value\n        };\n      case \"selectValueChange\":\n        return {\n          ...state,\n          fieldType: action.payload.value\n        };\n      case \"newOptionSpawn\":\n        return {\n          ...state,\n          fieldOptions: [...state.fieldOptions, { id: uniqid(), value: \"\" }]\n        };\n      case \"clear\":\n        return blankFieldObject;\n      case \"optionValueChange\":\n        return {\n          ...state,\n          fieldOptions: state.fieldOptions.map((el: any) =>\n            el.id === action.payload.id\n              ? { ...el, value: action.payload.value }\n              : el\n          )\n        };\n      case \"optionDelete\":\n        return state.fieldInForm && state.fieldOptions.some(el => el.id === action.payload.id && el.preselected)\n          ? {\n              ...state,\n              fieldInForm: false,\n              fieldOptions: state.fieldOptions.filter(\n                e => e.id !== action.payload.id\n              )\n            }\n          : {\n              ...state,\n              fieldOptions: state.fieldOptions.filter(\n                e => e.id !== action.payload.id\n              )\n            };\n      case \"setWithPaylod\":\n        return action.payload.obj;\n\n      default:\n        return state;\n    }\n  }, blankFieldObject);\n\n  const fieldMethods = {\n    onNameChange(event: any) {\n      setEditedField({\n        type: \"fieldNameChange\",\n        payload: { value: event.target.value }\n      });\n    },\n    onSelectChange(event: any) {\n      setEditedField({\n        type: \"selectValueChange\",\n        payload: { value: event.target.value }\n      });\n    },\n    handleOptionSpawn(e) {\n      e.preventDefault();\n      setEditedField({\n        type: \"newOptionSpawn\"\n      });\n    },\n    toggleDisplayComponent() {\n      displayComponent ? setDisplayComponent(false) : setDisplayComponent(true);\n      setEditedField({ type: \"clear\" });\n    },\n    onOptionDelete(event: any) {\n      setEditedField({\n        type: \"optionDelete\",\n        payload: { id: event.currentTarget.id }\n      });\n    },\n    onOptionChange(id, event) {\n      setEditedField({\n        type: \"optionValueChange\",\n        payload: { value: event.target.value, id }\n      });\n    },\n    setupEditedField(obj: any) {\n      setEditedField({\n        type: \"setWithPaylod\",\n        payload: { obj }\n      });\n      !displayComponent ? setDisplayComponent(true) : null;\n    },\n    saveEditedField(e) {\n      e.preventDefault();\n\n      const fieldIsUpdated = async () => {\n        const { fieldName, fieldType, fieldOptions, _id } = editedField;\n        const res = await axios({\n          method: \"PUT\",\n          url: `${globalVars.serverURL}/fields/${_id}`,\n          params: { key: user.user.userkey },\n          data: { fieldName, fieldType, fieldOptions },\n          responseType: \"json\"\n        });\n        const data = await res.data;\n        if (data.msg === globalVars.msgSuccess) {\n          reset();\n        }\n      };\n\n      const fieldIsCreated = async () => {\n        const res = await axios({\n          method: \"POST\",\n          params: { key: user.user.userkey },\n          url: `${globalVars.serverURL}/fields/`,\n          data: editedField,\n          responseType: \"json\"\n        });\n        const data = await res.data;\n        if (data.msg === globalVars.msgSuccess) {\n          reset();\n        }\n      };\n      state.some(field => field._id === editedField._id)\n        ? fieldIsUpdated()\n        : fieldIsCreated();\n    }\n  };\n\n  const reset = () => {\n    setDisplayComponent(false);\n    addField(dispatch, editedField);\n    setEditedField({ type: \"clear\" });\n  };\n\n  const deleteFieldRes = async (id: any) => {\n    const res = await axios({\n      method: \"DELETE\",\n      params: { key: user.user.userkey },\n      url: `${globalVars.serverURL}/fields/${id}`,\n      responseType: \"json\"\n    });\n    const resData = await res.data;\n    resData.msg === globalVars.msgSuccess ? deleteField(dispatch, id) : null;\n  };\n\n  return (\n    <Box mt=\"1rem\" mb=\"5rem\">\n      <CustomFieldsList\n        deleteFieldRes={deleteFieldRes}\n        state={state}\n        setupEditedField={fieldMethods.setupEditedField}\n      />\n      <AddOrEditField\n        editedField={editedField}\n        displayComponent={displayComponent}\n        fieldMethods={fieldMethods}\n        handleOption={\n          <SelectFieldOptions\n            options={editedField.fieldOptions}\n            fieldMethods={fieldMethods}\n          />\n        }\n      />\n    </Box>\n  );\n};\n\nexport default CustomFields;\n"]},"metadata":{},"sourceType":"module"}